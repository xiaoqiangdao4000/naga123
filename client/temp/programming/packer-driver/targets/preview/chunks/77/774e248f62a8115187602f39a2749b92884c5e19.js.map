{"version":3,"sources":["file:///C:/Users/zzx/Desktop/naga123/client/assets/script/utils/userMgr.ts"],"names":["_decorator","Component","sys","director","ccclass","property","userMgr","account","userid","nickname","password","score","sign","ip","sex","roomid","bindaccount","hallip","hallport","noticemsg","serverMap","getInstance","instance","start","console","log","globalThis","getAccount","userData","localStorage","getItem","data","JSON","parse","userinfo","saveAccount","setItem","stringify","onGuest","eventTargets","emit","s","info","push","loadScene","onAccountLogin","onBindAccount","getGameInfo","gamename","i","length","name"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, sys, director, game } from 'cc';\r\nimport HTTP from './HTTP';\r\nconst { ccclass, property } = _decorator;\r\n@ccclass('userMgr')\r\nexport class userMgr extends Component {\r\n\r\n    public account = null;  //账号\r\n    public userid = 0;      //用户id\r\n    public nickname = '';   //昵称\r\n    public password = '';   //密码\r\n    public score = 0;   //分数\r\n    public sign = 0;        //标志\r\n    public ip = '';         //ip\r\n    public sex = 0;         //性别 \r\n    public roomid = null;   //房间数据\r\n    public bindaccount = 0;    //绑定账号\r\n    public hallip = '';     //大厅ip\r\n    public hallport = 0;    //大厅端口\r\n    public noticemsg = [];  //消息公告\r\n    public serverMap = [];\r\n\r\n    static instance = null;\r\n\r\n    public static getInstance() {\r\n        if (userMgr.instance == null) {\r\n            userMgr.instance = new userMgr();\r\n            return userMgr.instance;\r\n        }\r\n        else {\r\n            return userMgr.instance;\r\n        }\r\n    }\r\n\r\n    start() {\r\n        console.log('userMgr =====')\r\n        globalThis.userMgr = userMgr.getInstance();\r\n    }\r\n\r\n    //获取账号信息\r\n    getAccount() {\r\n        let userData = sys.localStorage.getItem('userinfo');\r\n        let data = JSON.parse(userData);\r\n        let userinfo = {\r\n            nickname: '',\r\n            password: '',\r\n        };\r\n        if (data == null) {\r\n            userinfo.nickname = 'guest'\r\n            userinfo.password = '';\r\n        }\r\n        else {\r\n\r\n            userinfo.nickname = data.nickname;\r\n            userinfo.password = data.password;\r\n        }\r\n        console.log('获取到本地账户:', userinfo);\r\n        return userinfo;\r\n    }\r\n\r\n    //保存账号信息\r\n    saveAccount(nickname: string, password: string) {\r\n        let data = {\r\n            nickname: nickname,\r\n            password: password,\r\n        }\r\n        sys.localStorage.setItem('userinfo', JSON.stringify(data));\r\n    }\r\n\r\n    //游客登陆\r\n    onGuest(data) {\r\n        if (data.userid == 0) {\r\n            globalThis.eventTargets.emit('login_popTips', '游客登陆失败！');\r\n            console.log('游客登陆失败:', data);\r\n            return;\r\n        }\r\n        else {\r\n            globalThis.userMgr.userid = data.userid;\r\n            globalThis.userMgr.nickname = data.nickname;\r\n            globalThis.userMgr.score = data.score;\r\n            globalThis.userMgr.password = data.password;\r\n            globalThis.userMgr.roomid = data.roomid;\r\n            globalThis.userMgr.bindaccount = data.bindaccount;\r\n            globalThis.userMgr.saveAccount(data.nickname, data.password);\r\n            globalThis.userMgr.serverMap = [];\r\n            for(var s in data.serverMap){\r\n                var info = data.serverMap[s];\r\n                globalThis.userMgr.serverMap.push(info)\r\n            }\t\r\n            // globalThis.userMgr.hallip = data.hallip;\r\n            // globalThis.userMgr.hallport = data.hallport;\r\n            // HTTP.getInstance().setUrl(data.hallip, data.hallport);\r\n            \r\n            globalThis.eventTargets.emit('login_poploading', 'hide', '游客登完毕!');\r\n            console.log('游客登陆成功!服务器返回:' + data.userid + ' ,' + data.nickname + ' ,' + data.score + ' ,' + data.password + ' ,' + data.roomid + ' ,' + data.bindaccount);\r\n            console.log('---开始切换场景---');\r\n            director.loadScene('hallScene');\r\n        }\r\n    }\r\n\r\n    //账号登陆\r\n    onAccountLogin(data) {\r\n        if (data.userid == 0) {\r\n            globalThis.eventTargets.emit('login_popTips', '账号登陆失败:用户不存在或密码错误!');\r\n            return;\r\n        }\r\n        globalThis.userMgr.userid = data.userid;\r\n        globalThis.userMgr.nickname = data.nickname;\r\n        globalThis.userMgr.score = data.score;\r\n        globalThis.userMgr.password = data.password;\r\n        globalThis.userMgr.roomid = data.roomid;\r\n        globalThis.userMgr.bindaccount = data.bindaccount;\r\n        globalThis.userMgr.serverMap = [];\r\n        for(var s in data.serverMap){\r\n            var info = data.serverMap[s];\r\n            globalThis.userMgr.serverMap.push(info)\r\n        }\t\r\n        // globalThis.userMgr.hallip = data.hallip;\r\n        // globalThis.userMgr.hallport = data.hallport;\r\n        // HTTP.getInstance().setUrl(data.hallip, data.hallport);\r\n        globalThis.userMgr.saveAccount(data.nickname, data.password);\r\n        globalThis.eventTargets.emit('login_poploading', 'hide', '游客登陆中，请稍等!');\r\n        console.log('账号登陆成功!服务器返回:' + data.userid + ' ,' + data.nickname + ' ,' + data.score + ' ,' + data.password + ' ,' + data.roomid + ' ,' + data.bindaccount);\r\n        console.log('---开始切换场景---');\r\n        director.loadScene('hallScene');\r\n    }\r\n\r\n    //账号绑定\r\n    onBindAccount(data) {\r\n        if (data.userid == 0) {\r\n            globalThis.eventTargets.emit('hall_popTips', '绑定账号失败！');\r\n            return;\r\n        }\r\n        globalThis.userMgr.userid = data.userid;\r\n        globalThis.userMgr.nickname = data.nickname;\r\n        globalThis.userMgr.password = data.password;\r\n        globalThis.userMgr.bindaccount = data.bindaccount;\r\n        globalThis.userMgr.saveAccount(data.nickname, data.password);\r\n        globalThis.eventTargets.emit('hall_bindAccountSuc', data.nickname, '绑定账号成功!');\r\n        globalThis.eventTargets.emit('login_poploading', 'hide', '绑定账号成功!');\r\n        console.log('绑定账号成功!:' + data.userid + ' ,' + data.nickname + ' ,' + data.password + ' ,' + data.bindaccount);\r\n    }\r\n\r\n    //获取当前游戏的数据\r\n    getGameInfo(gamename)\r\n    {\r\n        for(let i = 0; i < globalThis.userMgr.serverMap.length; i++)\r\n        {\r\n            if(globalThis.userMgr.serverMap[i].name == gamename)\r\n            {\r\n                return globalThis.userMgr.serverMap[i];\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n"]}