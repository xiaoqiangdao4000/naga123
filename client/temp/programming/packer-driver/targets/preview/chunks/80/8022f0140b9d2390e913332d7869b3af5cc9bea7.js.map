{"version":3,"sources":["file:///C:/Users/zzx/Desktop/naga123/client/assets/script/utils/HTTP.ts"],"names":["HTTP","sys","Url","url","master_url","token","getInstance","instance","sendRequest","path","data","handler","extraUrl","xhr","XMLHttpRequest","timeout","sendpath","sendtext","k","requestURL","encodeURI","console","log","open","isNative","setRequestHeader","onreadystatechange","readyState","status","respText","responseText","ret","JSON","parse","e","errcode","errmsg","send"],"mappings":"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","sourcesContent":["import { sys } from \"cc\";\r\n\r\nexport default class HTTP {\r\n    public Url = 'http://127.0.0.1:3000';\r\n    public url = this.Url;\r\n    public master_url = this.Url;\r\n    public token = null;\r\n\r\n    public static instance = null;\r\n\r\n    static getInstance() {\r\n        if (this.instance == null) {\r\n            this.instance = new HTTP();\r\n            return this.instance;\r\n        }\r\n        else {\r\n            return this.instance;\r\n        }\r\n    }\r\n\r\n    sendRequest(path, data, handler, extraUrl) {\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.timeout = 5000;\r\n\r\n        if (data == null) {\r\n            data = {};\r\n        }\r\n        if (extraUrl == null) {\r\n            extraUrl = this.url;\r\n            // console.log(\"修改后的extraUrl\", extraUrl);\r\n        }\r\n\r\n        //解析请求路由以及格式化请求参数\r\n        var sendpath = path;\r\n        var sendtext = '?';\r\n        for (var k in data) {\r\n            if (sendtext != \"?\") {\r\n                sendtext += \"&\";\r\n            }\r\n            sendtext += (k + \"=\" + data[k]);\r\n        }\r\n\r\n        //组装完整的URL\r\n        var requestURL = extraUrl + sendpath + encodeURI(sendtext);\r\n\r\n        //发送请求\r\n        console.log(\"RequestURL:\" + requestURL);\r\n\r\n        xhr.open(\"GET\", requestURL, true);\r\n\r\n        if (sys.isNative) {\r\n            //xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\", \"text/html;charset=UTF-8\");\r\n            xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\r\n        }\r\n\r\n        xhr.onreadystatechange = function () {\r\n            if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\r\n                var respText = xhr.responseText;\r\n                var ret = null;\r\n                try {\r\n                    ret = JSON.parse(respText);\r\n                    //console.log(\"服务端返回的结果为\", ret);\r\n                } catch (e) {\r\n                    console.log(\"err:\" + e);\r\n                    ret = {\r\n                        errcode: -10001,\r\n                        errmsg: e\r\n                    };\r\n                }\r\n                if (handler) {\r\n                    handler(ret);\r\n                }\r\n                handler = null;\r\n            } else if (xhr.readyState === 4) {\r\n                // console.log('readystate:' + xhr.readyState + ', status:' + xhr.status);\r\n            } else {\r\n                // console.log('other readystate:' + xhr.readyState + ', status:' + xhr.status);\r\n            }\r\n        };\r\n\r\n        try {\r\n            xhr.send();\r\n        } catch (e) {\r\n            console.log('异常:', e);\r\n\r\n        }\r\n        return xhr;\r\n    }\r\n}"]}