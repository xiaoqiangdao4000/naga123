{"version":3,"sources":["file:///C:/Users/zzx/Desktop/naga123/client/assets/script/utils/websocket.ts"],"names":["_decorator","Component","ccclass","property","websocket","getInstance","instance","constructor","_ws","onmessage_callback","start","console","log","update","deltaTime","connectServer","ip","port","addr","ws","WebSocket","onopen","onmessage","result","msg","JSON","parse","data","type","onMessage","globalThis","curgame","sendMssage","send","stringify"],"mappings":";;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;;;;;;;;;OACf;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBH,U;;2BAGjBI,S,WADZF,OAAO,CAAC,WAAD,C,2BAAR,MACaE,SADb,SAC+BH,SAD/B,CACyC;AAKnB,eAAXI,WAAW,GAAG;AACjB,cAAI,KAAKC,QAAL,IAAiB,IAArB,EAA2B;AACvB,iBAAKA,QAAL,GAAgB,IAAIF,SAAJ,EAAhB;AACA,mBAAO,KAAKE,QAAZ;AACH,WAHD,MAIK;AACD,mBAAO,KAAKA,QAAZ;AACH;AACJ;;AAEDC,QAAAA,WAAW,GAAG;AACV;AADU,eAbdC,GAac,GAbH,IAaG;AAAA,eAZdC,kBAYc,GAZO,IAYP;AAEb;;AAEDC,QAAAA,KAAK,GAAG;AACJC,UAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ;AACH;;AAEDC,QAAAA,MAAM,CAACC,SAAD,EAAoB,CACzB;;AAEDC,QAAAA,aAAa,CAACC,EAAD,EAAKC,IAAL,EAAW;AACpB;AACA,cAAIC,IAAI,GAAG,UAAUF,EAAV,GAAe,GAAf,GAAqBC,IAAhC;AACA,cAAME,EAAE,GAAG,IAAIC,SAAJ,CAAcF,IAAd,CAAX;AACA,eAAKV,GAAL,GAAWW,EAAX;;AACAA,UAAAA,EAAE,CAACE,MAAH,GAAY,MAAM;AACdV,YAAAA,OAAO,CAACC,GAAR,CAAY,gBAAZ;AACH,WAFD;;AAIAO,UAAAA,EAAE,CAACG,SAAH,GAAgBC,MAAD,IAAY;AACvB,gBAAIC,GAAG,GAAGC,IAAI,CAACC,KAAL,CAAWH,MAAM,CAACI,IAAlB,CAAV;AACA,gBAAIC,IAAI,GAAGJ,GAAG,CAACI,IAAf;AACA,gBAAID,IAAI,GAAGH,GAAG,CAACG,IAAf;AACA,iBAAKE,SAAL,CAAeD,IAAf,EAAqBD,IAArB;AACH,WALD;AAMH;;AAEDE,QAAAA,SAAS,CAACD,IAAD,EAAOD,IAAP,EAAa;AAElB,cAAIG,UAAU,CAACC,OAAf,EAAwB;AACpBD,YAAAA,UAAU,CAACC,OAAX,CAAmBF,SAAnB,CAA6BD,IAA7B,EAAmCD,IAAnC;AACA;AACH;;AAED,kBAAQC,IAAR;AACI,iBAAK,YAAL;AACI;AAEI;AACH;;AACL,iBAAK,cAAL;AACI;AAEI;AACH;;AACL;AACI;AAZR,WAPkB,CAqBlB;;AACH;;AAEDI,QAAAA,UAAU,CAACJ,IAAD,EAAYD,IAAZ,EAAuB;AAC7B,cAAIH,GAAG,GAAG;AACNI,YAAAA,IAAI,EAAEA,IADA;AAEND,YAAAA,IAAI,EAAEA;AAFA,WAAV;;AAIA,eAAKnB,GAAL,CAASyB,IAAT,CAAcR,IAAI,CAACS,SAAL,CAAeV,GAAf,CAAd;AACH;;AAzEoC,O,UACvBlB,Q,GAAW,I","sourcesContent":["import { _decorator, Component, Node, director } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('websocket')\r\nexport class websocket extends Component {\r\n    public static instance = null;\r\n    _ws: any = null;\r\n    onmessage_callback = null;\r\n\r\n    static getInstance() {\r\n        if (this.instance == null) {\r\n            this.instance = new websocket();\r\n            return this.instance;\r\n        }\r\n        else {\r\n            return this.instance;\r\n        }\r\n    }\r\n\r\n    constructor() {\r\n        super();\r\n    }\r\n\r\n    start() {\r\n        console.log('websocket onstart')\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n    }\r\n\r\n    connectServer(ip, port) {\r\n        //'ws://127.0.0.1:3000'\r\n        let addr = 'ws://' + ip + ':' + port;\r\n        const ws = new WebSocket(addr);\r\n        this._ws = ws;\r\n        ws.onopen = () => {\r\n            console.log('连接--游戏服务器--成功！');\r\n        }\r\n\r\n        ws.onmessage = (result) => {\r\n            let msg = JSON.parse(result.data);\r\n            let type = msg.type;\r\n            let data = msg.data;\r\n            this.onMessage(type, data);\r\n        }\r\n    }\r\n\r\n    onMessage(type, data) {\r\n\r\n        if (globalThis.curgame) {\r\n            globalThis.curgame.onMessage(type, data);\r\n            return;\r\n        }\r\n\r\n        switch (type) {\r\n            case 'guestLogin':\r\n                {\r\n\r\n                    break;\r\n                }\r\n            case 'accountLogin':\r\n                {\r\n\r\n                    break;\r\n                }\r\n            default:\r\n                break;\r\n        }\r\n        // console.log('接受到服务器消息:' + type + ',数据:' + data);\r\n    }\r\n\r\n    sendMssage(type: any, data: any) {\r\n        let msg = {\r\n            type: type,\r\n            data: data,\r\n        }\r\n        this._ws.send(JSON.stringify(msg));\r\n    }\r\n}"]}