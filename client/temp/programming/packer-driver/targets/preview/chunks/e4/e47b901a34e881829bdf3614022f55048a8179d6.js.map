{"version":3,"sources":["file:///Users/zzx/Desktop/naga123/client/assets/script/utils/HTTP.ts"],"names":["HTTP","sys","url","token","getInstance","instance","setUrl","ip","port","console","log","sendRequest","path","data","handler","extraUrl","xhr","XMLHttpRequest","timeout","ontimeout","globalThis","eventTargets","emit","onerror","sendpath","sendtext","k","requestURL","encodeURI","open","isNative","setRequestHeader","onreadystatechange","readyState","status","respText","responseText","ret","JSON","parse","e","errcode","errmsg","send"],"mappings":"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","sourcesContent":["import { sys } from \"cc\";\n\nexport default class HTTP {\n    public url = 'http://127.0.0.1:3000';\n    public token = null;\n\n    public static instance = null;\n\n    static getInstance() {\n        if (this.instance == null) {\n            this.instance = new HTTP();\n            return this.instance;\n        }\n        else {\n            return this.instance;\n        }\n    }\n\n    setUrl(ip, port) {\n        this.url = 'http://' + ip + ':' + port;\n        console.log('设置新的http地址=', this.url);\n    }\n\n    sendRequest(path, data, handler, extraUrl) {\n        var xhr = new XMLHttpRequest();\n        xhr.timeout = 5000;\n\n        xhr.ontimeout = function () {\n            console.log('连接超时，请检查网络!');\n            globalThis.eventTargets.emit('login_poploading', 'hide', '连接超时，请检查网络!', 1);\n        }\n\n        xhr.onerror = function () {\n            console.log('网络连接错误!');\n            globalThis.eventTargets.emit('login_poploading', 'hide', '连接超时，请检查网络!', 1);\n        }\n\n        if (data == null) {\n            data = {};\n        }\n        if (extraUrl == null) {\n            extraUrl = this.url;\n            console.log(\"修改后的extraUrl\", extraUrl);\n        }\n\n        //解析请求路由以及格式化请求参数\n        var sendpath = path;\n        var sendtext = '?';\n        for (var k in data) {\n            if (sendtext != \"?\") {\n                sendtext += \"&\";\n            }\n            sendtext += (k + \"=\" + data[k]);\n        }\n\n        //组装完整的URL\n        var requestURL = extraUrl + sendpath + encodeURI(sendtext);\n\n        //发送请求\n        console.log(\"RequestURL:\" + requestURL);\n\n        xhr.open(\"GET\", requestURL, true);\n\n        if (sys.isNative) {\n            //xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\", \"text/html;charset=UTF-8\");\n            xhr.setRequestHeader(\"Accept-Encoding\", \"gzip,deflate\");\n        }\n\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4 && (xhr.status >= 200 && xhr.status < 300)) {\n                var respText = xhr.responseText;\n                var ret = null;\n                try {\n                    ret = JSON.parse(respText);\n                    //console.log(\"服务端返回的结果为\", ret);\n                } catch (e) {\n                    console.log(\"err:\" + e);\n                    ret = {\n                        errcode: -10001,\n                        errmsg: e\n                    };\n                }\n                if (handler) {\n                    handler(ret);\n                }\n                handler = null;\n            } else if (xhr.readyState === 4) {\n                // console.log('readystate:' + xhr.readyState + ', status:' + xhr.status);\n            } else {\n                // console.log('other readystate:' + xhr.readyState + ', status:' + xhr.status);\n            }\n        };\n\n        try {\n            xhr.send();\n        } catch (e) {\n            console.log('异常:', e);\n\n        }\n        return xhr;\n    }\n}"]}