{"version":3,"sources":["file:///Users/zzx/Desktop/naga123/client/assets/script/sgj/sgj_run.ts"],"names":["_decorator","Component","AudioMgr","ccclass","property","globalThis","sgjEvent","EventTarget","sgj_run","startIndex","endIndex","runCount","start","update","deltaTime","play","stop","resetMask","inst","playOneShot","schedule","updateMask","console","log","unschedule","i","sgj_view","mask_node","active","light_node","curIndex","Math","floor","emit"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, math } from 'cc';\nimport { AudioMgr } from '../utils/AudioMgr';\nconst { ccclass, property } = _decorator;\nif (globalThis.sgjEvent == null) {\n    globalThis.sgjEvent = new EventTarget();\n}\n@ccclass('sgj_run')\nexport class sgj_run extends Component {\n\n    startIndex = 0; //开始格子\n    endIndex = 0;   //中奖格子\n    runCount = 72;  //运行圈数\n\n    start() {\n        globalThis.sgj_run = this;\n    }\n\n    update(deltaTime: number) {\n\n    }\n\n    play(endIndex) {\n        this.stop();\n        this.startIndex = 0;\n        this.endIndex = endIndex + this.runCount; //中奖格子加上圈数\n        this.resetMask();\n        AudioMgr.inst.playOneShot('sound/sgj/turnstep1');\n        this.schedule(this.updateMask, 0.1);\n        console.log('播放中奖动画');\n    }\n\n    stop() {\n        this.unschedule(this.updateMask);\n    }\n\n    resetMask() {\n        for (let i = 0; i < 24; i++) {\n            globalThis.sgj_view.mask_node[i].active = false;\n            globalThis.sgj_view.light_node[i].active = false;\n        }\n    }\n\n    updateMask() {\n        //中奖结束回调\n        let curIndex = Math.floor(this.startIndex);\n        if (curIndex == this.endIndex) {\n            this.unschedule(this.updateMask);\n            globalThis.sgjEvent.emit('sgj_callback', '中奖结束!');\n            return;\n        }\n\n        for (let i = 0; i < 24; i++) {\n            //当前高亮的格子\n            if (curIndex == i) {\n                globalThis.sgj_view.mask_node[i].active = true;\n                globalThis.sgj_view.light_node[i].active = true;\n            }\n            else {\n                globalThis.sgj_view.mask_node[i].active = false;\n                globalThis.sgj_view.light_node[i].active = false;\n            }\n        }\n\n        //速度控制\n        if (this.startIndex < this.startIndex + 6) {\n            this.startIndex = this.startIndex + 0.5\n        }\n\n\n\n\n    }\n}\n\n\n\n"]}