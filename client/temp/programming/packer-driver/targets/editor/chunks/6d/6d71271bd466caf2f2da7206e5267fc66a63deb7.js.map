{"version":3,"sources":["file:///Users/zzx/Desktop/naga123/client/assets/script/utils/userMgr.ts"],"names":["_decorator","Component","sys","director","HTTP","ccclass","property","userMgr","account","userid","nickname","password","score","sign","ip","sex","roomid","bindaccount","hallip","hallport","getInstance","instance","start","console","log","globalThis","getAccount","userData","localStorage","getItem","data","JSON","parse","userinfo","saveAccount","setItem","stringify","onGuest","eventTargets","emit","setUrl","loadScene","onAccountLogin","onBindAccount"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, sys, director } from 'cc';\nimport HTTP from './HTTP';\nconst { ccclass, property } = _decorator;\n@ccclass('userMgr')\nexport class userMgr extends Component {\n\n    public account = null;  //账号\n    public userid = 0;      //用户id\n    public nickname = '';   //昵称\n    public password = '';   //密码\n    public score = 0;   //分数\n    public sign = 0;        //标志\n    public ip = '';         //ip\n    public sex = 0;         //性别 \n    public roomid = null;   //房间数据\n    public bindaccount = 0;    //绑定账号\n    public hallip = '';     //大厅ip\n    public hallport = 0;    //大厅端口\n    static instance = null;\n\n    public static getInstance() {\n        if (userMgr.instance == null) {\n            userMgr.instance = new userMgr();\n            return userMgr.instance;\n        }\n        else {\n            return userMgr.instance;\n        }\n    }\n\n    start() {\n        console.log('userMgr =====')\n        globalThis.userMgr = userMgr.getInstance();\n    }\n\n    //获取账号信息\n    getAccount() {\n        let userData = sys.localStorage.getItem('userinfo');\n        let data = JSON.parse(userData);\n        let userinfo = {\n            nickname: '',\n            password: '',\n        };\n        if (data == null) {\n            userinfo.nickname = 'guest'\n            userinfo.password = '';\n        }\n        else {\n\n            userinfo.nickname = data.nickname;\n            userinfo.password = data.password;\n        }\n        console.log('获取到本地账户:', userinfo);\n        return userinfo;\n    }\n\n    //保存账号信息\n    saveAccount(nickname: string, password: string) {\n        let data = {\n            nickname: nickname,\n            password: password,\n        }\n        sys.localStorage.setItem('userinfo', JSON.stringify(data));\n    }\n\n    //游客登陆\n    onGuest(data) {\n        if (data.userid == 0) {\n            globalThis.eventTargets.emit('login_popTips', '游客登陆失败！');\n            console.log('游客登陆失败:', data);\n            return;\n        }\n        else {\n            globalThis.userMgr.userid = data.userid;\n            globalThis.userMgr.nickname = data.nickname;\n            globalThis.userMgr.score = data.score;\n            globalThis.userMgr.password = data.password;\n            globalThis.userMgr.roomid = data.roomid;\n            globalThis.userMgr.bindaccount = data.bindaccount;\n            globalThis.userMgr.hallip = data.hallip;\n            globalThis.userMgr.hallport = data.hallport;\n            HTTP.getInstance().setUrl(data.hallip, data.hallport);\n            globalThis.userMgr.saveAccount(data.nickname, data.password);\n            console.log('游客登陆成功!服务器返回:' + data.userid + ' ,' + data.nickname + ' ,' + data.score + ' ,' + data.password + ' ,' + data.roomid + ' ,' + data.bindaccount);\n            console.log('---开始切换场景---');\n            director.loadScene('hallScene');\n        }\n    }\n\n    //账号登陆\n    onAccountLogin(data) {\n        if (data.userid == 0) {\n            globalThis.eventTargets.emit('login_popTips', '账号登陆失败:用户不存在或密码错误!');\n            return;\n        }\n        globalThis.userMgr.userid = data.userid;\n        globalThis.userMgr.nickname = data.nickname;\n        globalThis.userMgr.score = data.score;\n        globalThis.userMgr.password = data.password;\n        globalThis.userMgr.roomid = data.roomid;\n        globalThis.userMgr.bindaccount = data.bindaccount;\n        globalThis.userMgr.hallip = data.hallip;\n        globalThis.userMgr.hallport = data.hallport;\n        HTTP.getInstance().setUrl(data.hallip, data.hallport);\n        globalThis.userMgr.saveAccount(data.nickname, data.password);\n        console.log('账号登陆成功!服务器返回:' + data.userid + ' ,' + data.nickname + ' ,' + data.score + ' ,' + data.password + ' ,' + data.roomid + ' ,' + data.bindaccount);\n        console.log('---开始切换场景---');\n        director.loadScene('hallScene');\n    }\n\n    //账号绑定\n    onBindAccount(data) {\n        if (data.userid == 0) {\n            globalThis.eventTargets.emit('hall_popTips', '绑定账号失败！');\n            return;\n        }\n        globalThis.userMgr.userid = data.userid;\n        globalThis.userMgr.nickname = data.nickname;\n        globalThis.userMgr.password = data.password;\n        globalThis.userMgr.bindaccount = data.bindaccount;\n        globalThis.userMgr.saveAccount(data.nickname, data.password);\n        globalThis.eventTargets.emit('hall_bindAccountSuc',data.nickname, '绑定账号成功!');\n        \n        console.log('绑定账号成功!:' + data.userid + ' ,' + data.nickname + ' ,' + data.password + ' ,' + data.bindaccount);\n    }\n}\n\n\n\n"]}