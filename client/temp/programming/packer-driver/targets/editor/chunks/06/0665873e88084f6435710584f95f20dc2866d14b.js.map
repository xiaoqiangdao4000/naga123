{"version":3,"sources":["file:///Users/zzx/Desktop/naga123/client/assets/script/sgj/sgj_run.ts"],"names":["_decorator","Component","AudioMgr","ccclass","property","globalThis","sgjEvent","EventTarget","sgj_run","startIndex","endIndex","runCount","sound2_time","start","update","deltaTime","play","stop","resetMask","inst","playOneShot","schedule","updateMask","console","log","unschedule","i","sgj_view","mask_node","active","light_node","curIndex","Math","floor","emit"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, math } from 'cc';\nimport { AudioMgr } from '../utils/AudioMgr';\nconst { ccclass, property } = _decorator;\nif (globalThis.sgjEvent == null) {\n    globalThis.sgjEvent = new EventTarget();\n}\n@ccclass('sgj_run')\nexport class sgj_run extends Component {\n\n    startIndex = 0; //开始格子\n    endIndex = 0;   //中奖格子\n    runCount = 72;  //运行圈数\n    sound2_time = 0;//播放声音间隔时间\n\n    start() {\n        globalThis.sgj_run = this;\n    }\n\n    update(deltaTime: number) {\n\n    }\n\n    play(endIndex) {\n        this.stop();\n        this.startIndex = 0;\n        this.endIndex = endIndex + this.runCount; //中奖格子加上圈数\n        this.resetMask();\n        AudioMgr.inst.playOneShot('sound/sgj/turnstep1');\n        this.schedule(this.updateMask, 0.1);\n        console.log('播放中奖动画');\n    }\n\n    stop() {\n        this.unschedule(this.updateMask);\n    }\n\n    resetMask() {\n        for (let i = 0; i < 24; i++) {\n            globalThis.sgj_view.mask_node[i].active = false;\n            globalThis.sgj_view.light_node[i].active = false;\n        }\n    }\n\n    updateMask() {\n        //中奖结束回调\n        let curIndex = Math.floor(this.startIndex);\n        console.log('当前格子 = ', curIndex);\n        if (curIndex == this.endIndex) {\n            this.unschedule(this.updateMask);\n            globalThis.sgjEvent.emit('sgj_callback', '中奖结束!');\n            return;\n        }\n\n        for (let i = 0; i < 24; i++) {\n            //当前高亮的格子\n            if (curIndex == i) {\n                globalThis.sgj_view.mask_node[i].active = true;\n                globalThis.sgj_view.light_node[i].active = true;\n            }\n            else {\n                globalThis.sgj_view.mask_node[i].active = false;\n                globalThis.sgj_view.light_node[i].active = false;\n            }\n        }\n\n        //速度控制\n        if (this.startIndex < 7) {\n            this.startIndex = this.startIndex + 0.5;\n        }\n        else if (this.startIndex < 40) {\n            this.startIndex = this.startIndex + 1;\n            AudioMgr.inst.playOneShot('sound/sgj/turnstep2');\n        }\n\n\n        //音频控制\n        if (this.startIndex > 7 && this.startIndex < 40 && this.sound2_time > 1) {\n            this.sound2_time = 0;\n            AudioMgr.inst.playOneShot('sound/sgj/turnstep2');\n        }\n        else {\n            this.sound2_time = this.sound2_time + 2;\n        }\n\n\n    }\n}\n\n\n\n"]}