{"version":3,"sources":["file:///C:/Users/zzx/Desktop/naga123/client/assets/script/sgj/sgj_run.ts"],"names":["_decorator","Component","AudioMgr","ccclass","property","globalThis","sgjEvent","EventTarget","sgj_run","startIndex","endIndex","runCount","sound2_time","sound3_time","start","update","deltaTime","play","stop","resetMask","inst","playOneShot","schedule","updateMask","console","log","unschedule","i","sgj_view","mask_node","active","light_node","curIndex","Math","floor","emit","isPlaying"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Sprite, math } from 'cc';\r\nimport { AudioMgr } from '../utils/AudioMgr';\r\nconst { ccclass, property } = _decorator;\r\nif (globalThis.sgjEvent == null) {\r\n    globalThis.sgjEvent = new EventTarget();\r\n}\r\n@ccclass('sgj_run')\r\nexport class sgj_run extends Component {\r\n\r\n    startIndex = 0; //开始格子\r\n    endIndex = 0;   //中奖格子\r\n    runCount = 72;  //运行圈数\r\n    sound2_time = 0;//播放声音间隔时间,循环\r\n    sound3_time = false;//第三段音乐播放控制，不循环\r\n\r\n    start() {\r\n        globalThis.sgj_run = this;\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n\r\n    //播放中奖动画 1到24\r\n    play(endIndex) {\r\n        if (endIndex == 0) return;\r\n        this.stop();\r\n        this.startIndex = 0;\r\n        this.sound2_time = 0;\r\n        this.sound3_time = false;\r\n        this.endIndex = endIndex + this.runCount; //中奖格子加上圈数\r\n        this.resetMask();\r\n        AudioMgr.inst.playOneShot('sound/sgj/turnstep1');\r\n        this.schedule(this.updateMask, 0.05);\r\n        console.log('播放中奖动画,中奖格子 = ', endIndex);\r\n    }\r\n\r\n    stop() {\r\n        this.unschedule(this.updateMask);\r\n    }\r\n\r\n    resetMask() {\r\n        for (let i = 0; i < 24; i++) {\r\n            globalThis.sgj_view.mask_node[i].active = false;\r\n            globalThis.sgj_view.light_node[i].active = false;\r\n        }\r\n    }\r\n\r\n    updateMask() {\r\n        //中奖结束回调\r\n        let curIndex = Math.floor(this.startIndex) % 24 + 1;\r\n        //console.log('当前格子 = ', curIndex);\r\n        if (Math.floor(this.startIndex) == this.endIndex) {\r\n            console.log('中奖格子 = ', this.endIndex);\r\n            AudioMgr.inst.playOneShot('sound/sgj/turnstep4');\r\n            this.unschedule(this.updateMask);\r\n            globalThis.sgjEvent.emit('sgj_runcallback', '中奖结束!');\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < 24; i++) {\r\n            //当前高亮的格子\r\n            if (curIndex == i) {\r\n                globalThis.sgj_view.mask_node[i].active = true;\r\n                globalThis.sgj_view.light_node[i].active = true;\r\n            }\r\n            else {\r\n                globalThis.sgj_view.mask_node[i].active = false;\r\n                globalThis.sgj_view.light_node[i].active = false;\r\n            }\r\n        }\r\n\r\n        //速度控制\r\n        if (this.startIndex < 14) {\r\n            this.startIndex = this.startIndex + 0.5;\r\n        }\r\n        else if (this.startIndex < this.endIndex - 7) {\r\n            this.startIndex = this.startIndex + 1;\r\n        }\r\n        else if (this.startIndex < this.endIndex) {\r\n            this.startIndex = this.startIndex + 0.5;\r\n        }\r\n        else {\r\n            this.startIndex = this.startIndex + 0.5;\r\n        }\r\n\r\n        //音频控制2\r\n        if (this.startIndex > 14 && this.startIndex < this.endIndex - 16 && this.sound2_time > 1) {\r\n            this.sound2_time = 0\r\n            if (AudioMgr.inst.isPlaying()) {\r\n                console.log('正在播放中。。。。 = ', AudioMgr.inst.isPlaying());\r\n            }\r\n            else {\r\n                AudioMgr.inst.playOneShot('sound/sgj/turnstep2');\r\n                //console.log('正在播放中。。。。 = ', AudioMgr.inst.isPlaying());\r\n            }\r\n        }\r\n        else {\r\n            this.sound2_time = this.sound2_time + 0.5\r\n        }\r\n\r\n        //音频控制3\r\n        if (this.startIndex > this.endIndex - 16 && this.sound3_time == false) {\r\n            this.sound3_time = true;\r\n            AudioMgr.inst.playOneShot('sound/sgj/turnstep3');\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\n"]}